<app-client-header></app-client-header>

<div class="user-dashboard">
    <div class="left-panel">
        <div class="shopping-cart">
            <div class="panel-header">
                <h2 class="panel-title">Shopping List</h2>
                @if (!routeGenerated){
                <button class="btn-add-dialog" (click)="openProductsDialog()" title="Add/Search Products">
                    <i class="fa fa-plus"></i>
                </button>
                }
            </div>

            @if(shoppingList.length === 0) {
            <div class="empty-cart">
                <i class="fa fa-shopping-cart"></i>
                <p>Your shopping list is empty</p>
            </div>
            } @else {
            <div class="cart-items-container">
                <div class="cart-items">
                    @for(item of shoppingList; track item.id) {
                    <div class="cart-item" [ngClass]="{'collected': item.collected}">
                        <div class="cart-item-info">
                            <h4>{{ item.name }}</h4>
                            <p>{{ item.quantity }} x ‚Ç¨ {{ item.price.toFixed(2) }}</p>
                            <p class="cart-item-shelf">Shelf: {{ item.shelvingUnit || 'Not assigned' }}</p>
                        </div>
                        <div class="cart-item-actions">
                            @if (routeGenerated && !item.collected) {
                            <button class="btn-collect" (click)="markProductCollected(item)" title="Mark as collected">
                                <i class="fa fa-check"></i>
                            </button>
                            } @else if (routeGenerated && item.collected) {
                            <span class="collected-icon">
                                <i class="fa fa-check-circle"></i>
                            </span>
                            }
                            @if (!routeGenerated) {
                            <button class="btn-remove" (click)="removeFromCart(item.id)">
                                <i class="fa fa-minus"></i>
                            </button>
                            }
                        </div>
                    </div>
                    }
                </div>

                <div class="cart-summary">
                    <div class="summary-row">
                        <span>Total Items:</span>
                        <span>{{ getTotalItems() }}</span>
                    </div>
                    @if (routeGenerated) {
                    <div class="summary-row">
                        <span>Collected:</span>
                        <span>{{ getCollectedItems() }} / {{ shoppingList.length }}</span>
                    </div>
                    }
                    <div class="summary-row total">
                        <span>Total:</span>
                        <span>‚Ç¨ {{ getTotalPrice().toFixed(2) }}</span>
                    </div>
                    @if (!routeGenerated && shoppingList.length > 0) {
                    <button class="btn-generate-route" (click)="generateOptimalRoute()">
                        <i class="fa fa-route"></i> Show Shopping Route
                    </button>
                    } @else if (routeGenerated) {
                    <button class="btn-finish-shopping" (click)="finishShopping()">
                        <i class="fa fa-shopping-bag"></i> Finish Shopping
                    </button>
                    }
                </div>
            </div>
            }
        </div>
    </div>

    <div class="right-panel">
        <div class="table-container">
            <table class="grid-table">
                <tbody>
                    @for (row of rowIndices; track row) {
                    <tr>
                        @for (col of colIndices; track col) {
                        <td>
                            @if (row === 10 && col === 0) {
                            <div class="arrow-cell" [ngClass]="{
                                'current-position': isCurrentPosition(row, col),
                                'path-highlight': isCellInPath(row, col)
                            }">{{ gridData[row][col] }}</div>
                            } @else if (gridData[row][col] === 'üè™') {
                            <div class="register-cell" [ngClass]="{
                                'path-highlight': isCellInPath(row, col),
                                'current-position': isCurrentPosition(row, col)
                            }">
                                <i class="fas fa-cash-register"></i>
                            </div>
                            } @else if (gridData[row][col]) {
                            <div class="shelf-cell" [ngClass]="{
                                'highlighted': isUnitHighlighted(gridData[row][col]),
                                'path-highlight': isCellInPath(row, col),
                                'current-position': isCurrentPosition(row, col)
                            }">
                                {{ gridData[row][col] }}
                            </div>
                            } @else {
                            <div class="empty-cell" [ngClass]="{
                                'path-highlight': isCellInPath(row, col),
                                'current-position': isCurrentPosition(row, col)
                            }"></div>
                            }
                        </td>
                        }
                    </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>
<app-client-footer></app-client-footer>