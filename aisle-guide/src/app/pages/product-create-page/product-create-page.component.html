<app-admin-header></app-admin-header>

<div class="container">
    <div class="form-card">
        <h1>Create New Product</h1>

        <form [formGroup]="productForm" (ngSubmit)="onSubmit()">
            <div class="form-section">
                <h3>Basic Information</h3>

                <div class="form-group">
                    <label for="name">Product Name *</label>
                    <input id="name" type="text" formControlName="name" class="form-control">

                    @if(productForm.get('name')?.invalid && productForm.get('name')?.touched) {
                    @if(productForm.get('name')?.errors?.['required']) {
                    <div class="error-message">Product name is required.</div>
                    }
                    }
                </div>

                <div class="form-group">
                    <label for="price">Price *</label>
                    <input id="price" type="number" step="0.01" formControlName="price" class="form-control">

                    @if(productForm.get('price')?.invalid && productForm.get('price')?.touched) {
                    @if(productForm.get('price')?.errors?.['required']) {
                    <div class="error-message">Price is required.</div>
                    }
                    @if(productForm.get('price')?.errors?.['min']) {
                    <div class="error-message">Price must be greater than or equal to 0.</div>
                    }
                    }
                </div>

                <div class="form-group">
                    <label for="description">Description * (Max 200 characters)</label>
                    <textarea id="description" formControlName="description" class="form-control" rows="4"></textarea>

                    @if(productForm.get('description')?.invalid && productForm.get('description')?.touched) {
                    @if(productForm.get('description')?.errors?.['required']) {
                    <div class="error-message">Description is required.</div>
                    }
                    @if(productForm.get('description')?.errors?.['maxlength']) {
                    <div class="error-message">Description cannot exceed 200 characters.</div>
                    }
                    }
                </div>

                <div class="form-group">
                    <label for="category">Category *</label>
                    <input id="category" type="text" formControlName="category" class="form-control">

                    @if(productForm.get('category')?.invalid && productForm.get('category')?.touched) {
                    @if(productForm.get('category')?.errors?.['required']) {
                    <div class="error-message">Category is required.</div>
                    }
                    }
                </div>

                <div class="form-group">
                    <label for="isbn">ISBN *</label>
                    <input id="isbn" type="text" formControlName="isbn" class="form-control">

                    @if(productForm.get('isbn')?.invalid && productForm.get('isbn')?.touched) {
                    @if(productForm.get('isbn')?.errors?.['required']) {
                    <div class="error-message">ISBN is required.</div>
                    }
                    }
                </div>

                <div class="form-group">
                    <label for="shelvingUnit">Shelving Unit</label>
                    <input id="shelvingUnit" type="text" formControlName="shelvingUnit" class="form-control">
                </div>
            </div>

            <div class="nutrition-grid">
                <div class="form-group">
                    <label for="calories">Calories</label>
                    <input id="calories" type="number" formControlName="calories" class="form-control">

                    @if(productForm.get('calories')?.invalid && productForm.get('calories')?.touched) {
                    @if(productForm.get('calories')?.errors?.['min']) {
                    <div class="error-message">Calories cannot be negative.</div>
                    }
                    }
                </div>

                <div class="form-group">
                    <label for="protein">Protein (g)</label>
                    <input id="protein" type="number" step="0.1" formControlName="protein" class="form-control">

                    @if(productForm.get('protein')?.invalid && productForm.get('protein')?.touched) {
                    @if(productForm.get('protein')?.errors?.['min']) {
                    <div class="error-message">Protein cannot be negative.</div>
                    }
                    }
                </div>

                <div class="form-group">
                    <label for="carbohydrates">Carbohydrates (g)</label>
                    <input id="carbohydrates" type="number" step="0.1" formControlName="carbohydrates"
                        class="form-control">

                    @if(productForm.get('carbohydrates')?.invalid && productForm.get('carbohydrates')?.touched) {
                    @if(productForm.get('carbohydrates')?.errors?.['min']) {
                    <div class="error-message">Carbohydrates cannot be negative.</div>
                    }
                    }
                </div>

                <div class="form-group">
                    <label for="sugars">Sugars (g)</label>
                    <input id="sugars" type="number" step="0.1" formControlName="sugars" class="form-control">

                    @if(productForm.get('sugars')?.invalid && productForm.get('sugars')?.touched) {
                    @if(productForm.get('sugars')?.errors?.['min']) {
                    <div class="error-message">Sugars cannot be negative.</div>
                    }
                    }
                </div>

                <div class="form-group">
                    <label for="fat">Fat (g)</label>
                    <input id="fat" type="number" step="0.1" formControlName="fat" class="form-control">

                    @if(productForm.get('fat')?.invalid && productForm.get('fat')?.touched) {
                    @if(productForm.get('fat')?.errors?.['min']) {
                    <div class="error-message">Fat cannot be negative.</div>
                    }
                    }
                </div>

                <div class="form-group">
                    <label for="saturatedFat">Saturated Fat (g)</label>
                    <input id="saturatedFat" type="number" step="0.1" formControlName="saturatedFat"
                        class="form-control">

                    @if(productForm.get('saturatedFat')?.invalid && productForm.get('saturatedFat')?.touched) {
                    @if(productForm.get('saturatedFat')?.errors?.['min']) {
                    <div class="error-message">Saturated fat cannot be negative.</div>
                    }
                    }
                </div>

                <div class="form-group">
                    <label for="fiber">Fiber (g)</label>
                    <input id="fiber" type="number" step="0.1" formControlName="fiber" class="form-control">

                    @if(productForm.get('fiber')?.invalid && productForm.get('fiber')?.touched) {
                    @if(productForm.get('fiber')?.errors?.['min']) {
                    <div class="error-message">Fiber cannot be negative.</div>
                    }
                    }
                </div>

                <div class="form-group">
                    <label for="salt">Salt (g)</label>
                    <input id="salt" type="number" step="0.1" formControlName="salt" class="form-control">

                    @if(productForm.get('salt')?.invalid && productForm.get('salt')?.touched) {
                    @if(productForm.get('salt')?.errors?.['min']) {
                    <div class="error-message">Salt cannot be negative.</div>
                    }
                    }
                </div>

                <div class="form-group">
                    <label for="cholesterol">Cholesterol (mg)</label>
                    <input id="cholesterol" type="number" step="0.1" formControlName="cholesterol" class="form-control">

                    @if(productForm.get('cholesterol')?.invalid && productForm.get('cholesterol')?.touched) {
                    @if(productForm.get('cholesterol')?.errors?.['min']) {
                    <div class="error-message">Cholesterol cannot be negative.</div>
                    }
                    }
                </div>
            </div>

            <div class="form-section">
                <h3>Product Image *</h3>

                <div class="image-upload-container">
                    <div class="image-upload">
                        <input type="file" id="productImage" accept="image/*" (change)="onImageSelected($event)">
                        <label for="productImage" class="upload-btn">Choose Image</label>
                    </div>

                    @if(imagePreview) {
                    <div class="image-preview">
                        <img [src]="imagePreview" alt="Product preview">
                    </div>
                    }
                </div>

                @if(imageError && isFormSubmitted) {
                <div class="error-message">Product image is required.</div>
                }
            </div>

            @if(successMessage) {
            <div class="success-message">{{ successMessage }}</div>
            }

            <div class="form-actions">
                <button type="submit" [disabled]="productForm.invalid || isSubmitting" class="btn-primary">
                    @if(isSubmitting) {
                    <span>Creating...</span>
                    } @else {
                    <span>Create Product</span>
                    }
                </button>
            </div>
        </form>
    </div>
</div>

<app-admin-footer></app-admin-footer>